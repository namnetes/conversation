Ci-dessous le code de mon module proxy_manager.py dont l'objectif est de valider la ligne des infors proxy.
Peut-être faut t-il définir un constructeur qui prend en parametre les infos proxy qui son td'ailleurs attendu par "def get_proxy_info(self, proxy_line)"
Peut être faut-il que le construceur retourne None ou le dictionnaire attendu. Dans tous les cas donne un exemple d'appel depuis le programme.


#!/usr/bin/env python
# -*- coding: utf-8 -*-

from urllib.parse import urlparse
import logging
import socket
import re

class ProxyManager:
    def __init__(self, verbose=False):
        self.verbose = verbose

    def log_info(self, message):
        if self.verbose:
            logging.info(message)

    def log_error(self, message):
        logging.error(message)

    def get_proxy_info(self, proxy_line):
        validation_pattern = re.compile(r'^\s*proxy\s*=\s*(?:(\w+):(\w+)@)?(https?://[a-zA-Z0-9.-]+):(\d+)\s*$')
        validation_match = validation_pattern.match(proxy_line)

        if validation_match:
            extraction_match = validation_match

            proxy_dict = {
                "Username": extraction_match.group(1),
                "Password": extraction_match.group(2),
                "URL": extraction_match.group(3),
                "Port": extraction_match.group(4)
            }

            if self.check_connection(proxy_dict['URL'], proxy_dict['Port']):
                self.log_info(f"Proxy info extracted: {proxy_dict}")
                return proxy_dict
            else:
                self.log_error(f"Connection failed on {proxy_dict['URL']}:{proxy_dict['Port']}")
                return None
        else:
            self.log_error("Invalid proxy line")
            return None

    def get_hostname(self, url):
        """
        Extrait le nom d'hôte à partir de l'URL spécifiée.

        :param url: URL à partir de laquelle extraire le nom d'hôte.
        :return: Nom d'hôte extrait.
        """
        parsed_url = urlparse(url)
        return parsed_url.netloc

    def check_connection(self, ip, port):
        try:
            s = socket.create_connection((ip, port), timeout=5)
            s.close()
            self.log_info(f"Connection successful on {ip}:{port}")
            return True
        except (socket.timeout, ConnectionRefusedError):
            self.log_error(f"Connection failed on {ip}:{port}")
            return False
